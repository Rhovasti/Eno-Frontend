# AI Image Generation Flow Diagram

## User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FIRST TIME SETUP                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User â†’ "Create Character" â†’ Character Form                     â”‚
â”‚                                    â†“                             â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                            â”‚ â€¢ Name           â”‚                  â”‚
â”‚                            â”‚ â€¢ Description    â”‚                  â”‚
â”‚                            â”‚ â€¢ Art Style      â”‚                  â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                     â†“                            â”‚
â”‚                            Generate Reference                    â”‚
â”‚                                     â†“                            â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                            â”‚   [Preview]     â”‚                   â”‚
â”‚                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚                            â”‚  â”‚   ğŸ§™â€â™€ï¸    â”‚  â”‚ â† Regenerate     â”‚
â”‚                            â”‚  â”‚  Elara    â”‚  â”‚                   â”‚
â”‚                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚                            â”‚   [Save] [Try Again]                â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                     â†“                            â”‚
â”‚                            Character Profile Saved               â”‚
â”‚                              (with LoRA training)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                     â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         POSTING WITH IMAGE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Write Post â†’ Click "Add AI Image" â†’ Image Options              â”‚
â”‚                                           â†“                      â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                                  â”‚ Select:         â”‚             â”‚
â”‚                                  â”‚ â—‹ Elara        â”‚             â”‚
â”‚                                  â”‚ â—‹ New Characterâ”‚             â”‚
â”‚                                  â”‚ â—‹ Scene Only   â”‚             â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                           â†“                      â”‚
â”‚                                  Scene Description               â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                                  â”‚ "Casting fire   â”‚             â”‚
â”‚                                  â”‚  spell in dark  â”‚             â”‚
â”‚                                  â”‚  dungeon"       â”‚             â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                           â†“                      â”‚
â”‚                                    [Generate]                    â”‚
â”‚                                           â†“                      â”‚
â”‚                                  â³ Generating...                â”‚
â”‚                                     (10-15 sec)                  â”‚
â”‚                                           â†“                      â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                                  â”‚   ğŸ”¥ğŸ§™â€â™€ï¸ğŸ”¥    â”‚             â”‚
â”‚                                  â”‚ Elara casting   â”‚             â”‚
â”‚                                  â”‚ fire spell      â”‚             â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                           â†“                      â”‚
â”‚                                  [Attach to Post]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚     â”‚   Backend    â”‚     â”‚  External    â”‚
â”‚  (Browser)   â”‚     â”‚  (Node.js)   â”‚     â”‚  Services    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                     â”‚
       â”‚ 1. Request Image    â”‚                     â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ 2. Build Prompt     â”‚
       â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
       â”‚                     â”‚            â”‚        â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ 3. Call AI API      â”‚
       â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                     â”‚                     â”‚ Replicate/
       â”‚                     â”‚                     â”‚ Stability
       â”‚                     â”‚ 4. Image URL        â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ 5. Download Image   â”‚
       â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
       â”‚                     â”‚            â”‚        â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ 6. Upload to S3     â”‚
       â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                     â”‚                     â”‚ AWS S3
       â”‚                     â”‚ 7. S3 URL           â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                     â”‚                     â”‚
       â”‚                     â”‚ 8. Save to DB       â”‚
       â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
       â”‚                     â”‚            â”‚        â”‚
       â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚                     â”‚                     â”‚
       â”‚ 9. Return S3 URL    â”‚                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
       â”‚                     â”‚                     â”‚
       â”‚ 10. Display Image   â”‚                     â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                     â”‚
       â”‚            â”‚        â”‚                     â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                     â”‚
```

## Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users    â”‚     â”‚character_profilesâ”‚     â”‚   posts     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚â”€â”€â”€â”€<â”‚ user_id          â”‚     â”‚ id          â”‚
â”‚ username    â”‚     â”‚ game_id          â”‚>â”€â”€â”€â”€â”‚ beat_id     â”‚
â”‚ email       â”‚     â”‚ name             â”‚     â”‚ author_id   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ base_description â”‚     â”‚ content     â”‚
                    â”‚ style_modifiers  â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ reference_seed   â”‚            â”‚
                    â”‚ lora_model_id    â”‚            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                              â”‚                     â”‚
                              â†“                     â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  post_images     â”‚   â”‚ dice_rolls  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ id               â”‚   â”‚ id          â”‚
                    â”‚ post_id          â”‚>â”€â”€â”‚ post_id     â”‚
                    â”‚ character_id     â”‚   â”‚ notation    â”‚
                    â”‚ prompt           â”‚   â”‚ total       â”‚
                    â”‚ image_url        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ thumbnail_url    â”‚
                    â”‚ generation_paramsâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Breakdown

### Frontend Components
```
ThreadsPage
â”œâ”€â”€ PostForm
â”‚   â”œâ”€â”€ TextEditor
â”‚   â”œâ”€â”€ DiceRollSection
â”‚   â””â”€â”€ ImageGeneratorSection
â”‚       â”œâ”€â”€ CharacterSelector
â”‚       â”œâ”€â”€ SceneDescriptor
â”‚       â”œâ”€â”€ GenerationPreview
â”‚       â””â”€â”€ AttachButton
â””â”€â”€ PostDisplay
    â”œâ”€â”€ PostContent
    â”œâ”€â”€ DiceRollDisplay
    â””â”€â”€ ImageGallery
```

### Backend Endpoints
```
/api/characters
  POST   - Create new character profile
  GET    - List user's characters
  
/api/characters/:id/train
  POST   - Train LoRA model for character

/api/images/generate
  POST   - Generate new image
  
/api/posts/:postId/images
  POST   - Attach image to post
  GET    - Get post images
```

## Key Decisions Needed

1. **AI Service Selection**
   - Replicate (with LoRA): Best consistency, requires training
   - Leonardo AI: Good balance, immediate use
   - Stability AI: Most flexible, moderate consistency

2. **Character Creation Flow**
   - How many reference images for training?
   - Allow custom uploads or AI-generated only?
   - Pre-made character templates?

3. **User Limits**
   - Images per day/month?
   - Credit system or subscription?
   - Free tier limitations?

4. **Quality Settings**
   - Image resolution (512x512, 1024x1024)?
   - Multiple quality tiers?
   - Thumbnail generation?

5. **Content Moderation**
   - Automated prompt filtering?
   - Manual review process?
   - Banned words/concepts?