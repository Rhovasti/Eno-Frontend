<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Pelisivusto - Langat</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* GM Assistance Styling */
        .gm-assistance {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        
        .gm-assistance h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1.1em;
        }
        
        .assistance-description {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .suggestion-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .suggestion-controls select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
        }
        
        .btn-suggestion {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
        }
        
        .btn-suggestion:hover {
            background: #138496;
        }
        
        .btn-suggestion:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .suggestion-results {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .suggestion-results h5 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1em;
        }
        
        #suggestionContent {
            margin-bottom: 15px;
            line-height: 1.5;
            color: #212529;
        }
        
        .suggestion-item {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .suggestion-item:hover {
            background: #cce7ff;
        }
        
        .suggestion-item.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        .suggestion-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-use {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-use:hover {
            background: #218838;
        }
        
        .btn-new {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-new:hover {
            background: #5a6268;
        }
        
        .suggestion-loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .suggestion-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }
        
        /* Audio Generation Styling */
        #audioGenerationSection {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #6f42c1;
        }
        
        #audioGenerationSection h3 {
            color: #6f42c1;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .audio-generation-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        #audioPrompt {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
        }
        
        .audio-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        .audio-options select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
        }
        
        #generateAudioBtn {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
            align-self: flex-start;
        }
        
        #generateAudioBtn:hover {
            background: #5a32a3;
        }
        
        #generateAudioBtn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        #audioGenerationStatus {
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        #audioGenerationStatus.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        #audioGenerationStatus.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        #audioGenerationStatus.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #generatedAudioPreview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
        }
        
        .audio-player {
            width: 100%;
            margin: 10px 0;
        }
        
        .audio-info {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .audio-options {
                grid-template-columns: 1fr;
            }
        }

        /* Character Reference Styling */
        #characterDetectionStatus.detected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        #characterDetectionStatus.suggested {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        #characterDetectionStatus.none {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        #characterSelect {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        #characterSelect:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            outline: none;
        }
    </style>
    <link rel="stylesheet" href="../css/audioPlayer.css">
</head>
<body>
    <header>
        <h1>Pelisivusto</h1>
        <nav>
            <a href="../index.html">Etusivu</a>
            <a href="threads.html">Langat</a>
            <a href="storyboard.html">Storyboard</a>
            <a href="gm-selection.html">AI-pelinjohtajat</a>
            <a href="wiki_dynamic.html">Wiki</a>
        </nav>
    </header>

    <div class="container">
        <h2>Langat</h2>

        <select id="gameSelect">
            <option value="">Valitse peli</option>
        </select>

        <select id="chapterSelect" disabled>
            <option value="">Valitse Luku</option>
        </select>

        <button id="createChapterButton" disabled>Luo Uusi Luku</button>

        <div id="newChapterForm" style="display:none;">
            <h3>Luo Uusi Luku</h3>
            <form id="createChapterForm">
                <input type="text" id="chapterTitle" placeholder="Luvun otsikko" required>
                <textarea id="chapterDescription" placeholder="Luvun kuvaus"></textarea>
                <button type="submit">Luo Luku</button>
            </form>
        </div>

        <select id="beatSelect" disabled>
            <option value="">Valitse Beatti</option>
        </select>

        <button id="createBeatButton" disabled>Luo Uusi Beatti</button>

        <div id="newBeatForm" style="display:none;">
            <h3>Luo Uusi Beatti</h3>
            <form id="createBeatForm">
                <input type="text" id="beatTitle" placeholder="Beatin otsikko" required>
                <textarea id="beatContent" placeholder="Beatin sis√§lt√∂" required></textarea>
                <button type="submit">Luo Beatti</button>
            </form>
        </div>

        <div id="postsContainer"></div>

        <div id="newPostForm" style="display:none;">
            <h3>Luo uusi viesti</h3>
            <form id="createPostForm">
                <input type="text" id="postTitle" placeholder="Viestin otsikko" required>
                <textarea id="postContent" placeholder="Viestin sis√§lt√∂" required></textarea>
                
                <!-- Dice Roll Section -->
                <div class="dice-roll-section">
                    <h4>Nopanheitto (valinnainen)</h4>
                    <div class="dice-controls">
                        <input type="text" id="diceNotation" placeholder="esim. 2d6+3, 1d20" pattern="^\d+d\d+([+-]\d+)?$">
                        <input type="text" id="rollPurpose" placeholder="Mihin heitto? (esim. Hy√∂kk√§ys, Taito)">
                        <button type="button" id="rollDiceBtn">üé≤ Heit√§</button>
                    </div>
                    <div id="diceResult" class="dice-result" style="display:none;"></div>
                </div>
                
                <label>
                    <input type="checkbox" id="isGMPost"> Post as Game Master
                </label>
                
                <!-- GM Assistance Section (only visible when posting as GM) -->
                <div id="gmAssistanceSection" class="gm-assistance" style="display:none;">
                    <h4>ü§ñ AI-pelinjohtajan avustaja</h4>
                    <p class="assistance-description">Saa ehdotuksia tarinan jatkamiseen pelin nykyisen tilanteen perusteella</p>
                    
                    <div class="suggestion-controls">
                        <select id="suggestionType">
                            <option value="">Valitse ehdotustyyppi</option>
                            <option value="plot_advancement">üìö Juonen eteenp√§in vieminen</option>
                            <option value="character_development">üë• Hahmonkehitys</option>
                            <option value="environmental_details">üåç Ymp√§rist√∂kuvaus</option>
                            <option value="challenge_creation">‚öîÔ∏è Haasteen luominen</option>
                            <option value="dialogue_npc">üí¨ NPC-dialogi</option>
                            <option value="scene_transition">üîÑ Kohtauksen vaihto</option>
                        </select>
                        <button type="button" id="getSuggestionBtn" class="btn-suggestion">üí° Pyyd√§ ehdotus</button>
                    </div>
                    
                    <div id="suggestionResults" class="suggestion-results" style="display:none;">
                        <h5>Ehdotukset:</h5>
                        <div id="suggestionContent"></div>
                        <div class="suggestion-actions">
                            <button type="button" id="useSuggestionBtn" class="btn-use">‚úì K√§yt√§ ehdotusta</button>
                            <button type="button" id="newSuggestionBtn" class="btn-new">üîÑ Uusi ehdotus</button>
                        </div>
                    </div>
                </div>

                <!-- Auto Media Generation Options -->
                <div class="media-generation-options" style="background: #f0f8ff; border: 2px solid #4a90e2; border-radius: 8px; padding: 15px; margin: 15px 0;">
                    <h4 style="margin: 0 0 12px 0; color: #2c5aa0; font-size: 1.1em;">üé®üéµ Automaattinen median luonti</h4>
                    <p style="font-size: 0.9em; color: #5a5a5a; margin-bottom: 12px; font-style: italic;">
                        AI analysoi viestisi sis√§ll√∂n ja luo automaattisesti sopivat kuvat ja √§√§net tunnelman perusteella.
                    </p>

                    <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1; background: white; padding: 10px; border-radius: 4px; border: 1px solid #d0d0d0;">
                            <input type="checkbox" id="autoGenerateImageCheckbox" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 500;">üé® Luo AI-kuva</span>
                        </label>

                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; flex: 1; background: white; padding: 10px; border-radius: 4px; border: 1px solid #d0d0d0;">
                            <input type="checkbox" id="autoGenerateAudioCheckbox" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 500;">üéµ Luo AI-√§√§ni</span>
                        </label>
                    </div>

                    <div id="moodSelectorContainer" style="display: none;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #333;">Tunnelma / Atmosphere:</label>
                        <select id="moodSelector" style="width: 100%; padding: 10px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 1em; background: white;">
                            <option value="mysterious">üåë Mysterious / Dark (Mystinen / Pime√§)</option>
                            <option value="peaceful">üïäÔ∏è Peaceful / Calm (Rauhallinen / Tyyni)</option>
                            <option value="action">‚öîÔ∏è Exciting / Action (J√§nnitt√§v√§ / Toiminta)</option>
                            <option value="dramatic">üé≠ Dramatic / Tense (Dramaattinen / J√§nnittynyt)</option>
                            <option value="humorous">üòÑ Humorous / Light (Humoristinen / Kevyt)</option>
                            <option value="epic">üèÜ Epic / Heroic (Eeppinen / Sankarillinen)</option>
                            <option value="romantic">üíï Romantic / Emotional (Romanttinen / Tunteellinen)</option>
                            <option value="horror">üëª Horrific / Scary (Kauhistuttava / Pelottava)</option>
                        </select>
                        <p style="font-size: 0.85em; color: #666; margin-top: 6px;">
                            Valittu tunnelma vaikuttaa sek√§ kuvan tyyliin ett√§ √§√§nen laatuun.
                        </p>
                    </div>

                    <!-- Character Reference Section -->
                    <div id="characterReferenceSection" style="display: none; margin-top: 15px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #333;">
                            <span style="margin-right: 6px;">üé≠</span>Character Reference (optional):
                        </label>
                        <select id="characterSelect" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #d0d0d0; border-radius: 4px; font-size: 1em; background: white;">
                            <option value="">No character reference</option>
                            <!-- Populated dynamically from portraits folder -->
                        </select>
                        <small style="color: #666; display: block; margin-top: 5px; font-size: 0.85em;">
                            Select a character to maintain consistent appearance in generated images
                        </small>
                        <div id="characterDetectionStatus" style="display: none; margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 0.85em;">
                            <!-- Character detection status will be shown here -->
                        </div>
                    </div>
                </div>

                <button type="submit">L√§het√§</button>
            </form>
            
            <!-- Image Generation Section (HIDDEN - Using auto-generation instead) -->
            <div id="imageGenerationSection" style="display:none!important;">
                <h3>Luo AI-kuva viestiin</h3>
                <div class="image-generation-form">
                    <textarea id="imagePrompt" placeholder="Kuvaile mit√§ haluat kuvaan englanniksi tai yksinkertaisilla suomen sanoilla (esim. 'wizard in dark cave' tai 'velho luolassa')" rows="3"></textarea>
                    
                    <!-- Doodle Canvas -->
                    <div class="doodle-section">
                        <h4>Piirr√§ luonnos (valinnainen)</h4>
                        <canvas id="doodleCanvas" width="384" height="576" style="border: 1px solid #ddd; background: white; cursor: crosshair; max-width: 100%;"></canvas>
                        <div class="canvas-controls">
                            <button type="button" id="clearCanvasBtn">üóëÔ∏è Tyhjenn√§</button>
                            <button type="button" id="undoCanvasBtn">‚Ü©Ô∏è Kumoa</button>
                            <input type="color" id="brushColor" value="#000000">
                            <input type="range" id="brushSize" min="1" max="20" value="3">
                            <span id="brushSizeDisplay">3px</span>
                        </div>
                    </div>
                    
                    <div class="image-options">
                        <select id="styleSelect">
                            <option value="">Valitse tyyli</option>
                            <option value="comic-book">Comic Book</option>
                            <option value="line-art">Line Art (Sketch)</option>
                            <option value="fantasy-art">Fantasy Art</option>
                            <option value="cinematic">Cinematic</option>
                            <option value="digital-art">Digital Art</option>
                            <option value="anime">Anime</option>
                        </select>
                    </div>
                    
                    <button type="button" id="generateImageBtn">üé® Luo kuva</button>
                    <div id="imageGenerationStatus" style="display:none;"></div>
                    <div id="generatedImagePreview" style="display:none;"></div>
                </div>
            </div>
            
            <!-- Audio Generation Section (HIDDEN - Using auto-generation instead) -->
            <div id="audioGenerationSection" style="display:none!important;">
                <h3>Luo AI-√§√§ni viestiin</h3>
                <div class="audio-generation-form">
                    <textarea id="audioPrompt" placeholder="Kuvaile millaista √§√§nt√§ tai musiikkia haluat (esim. 'synkk√§ mets√§n tunnelma', 'mystinen taustamusiikki', 'askeleet kivisell√§ lattialla')" rows="3"></textarea>
                    
                    <div class="audio-options">
                        <select id="audioTypeSelect">
                            <option value="">Valitse √§√§ni-tyyppi</option>
                            <option value="ambient">üå´Ô∏è Tunnelma (ambient)</option>
                            <option value="music">üéµ Musiikki</option>
                            <option value="sfx">üîä √Ñ√§niefekti</option>
                        </select>
                        
                        <select id="audioStyleSelect">
                            <option value="">Valitse tyyli</option>
                            <option value="orchestral">üéº Orkestri</option>
                            <option value="cinematic">üé¨ Elokuvallinen</option>
                            <option value="acoustic">üé∏ Akustinen</option>
                            <option value="electronic">üéπ Elektroninen</option>
                            <option value="medieval">üè∞ Keskiaikainen</option>
                            <option value="dark">üåô Synkk√§</option>
                        </select>
                        
                        <select id="audioDurationSelect">
                            <option value="15">15 sekuntia</option>
                            <option value="30" selected>30 sekuntia</option>
                            <option value="60">60 sekuntia</option>
                        </select>
                    </div>
                    
                    <button type="button" id="generateAudioBtn">üéµ Luo √§√§ni</button>
                    <div id="audioGenerationStatus" style="display:none;"></div>
                    <div id="generatedAudioPreview" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/script.js"></script>
    <script src="../js/diceEngine.js"></script>
    <script src="../js/audioPlayer.js"></script>
    <script src="../js/threads.js"></script>
</body>
</html>