<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omat Pelit - Eno</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .game-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .game-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .game-card h3 {
            margin-top: 0;
            color: #333;
        }
        
        .game-stats {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
        
        .game-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .create-game-cta {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Omat Pelit</h1>
        <nav id="navBar">
            <a href="/">Etusivu</a>
            <a href="/hml/threads.html">Langat</a>
            <a href="/hml/storyboard.html">Storyboard</a>
            <a href="/hml/wiki.html">Wiki</a>
            <a href="/hml/my-games.html" class="active">Omat Pelit</a>
        </nav>
    </header>

    <main class="container">
        <div class="page-header">
            <h2>GM Dashboard - Hallinnoi pelejÃ¤si</h2>
            <a href="/hml/create-game.html" class="btn btn-primary">+ Luo uusi peli</a>
        </div>
        
        <div id="myGamesGrid" class="games-grid">
            <!-- Games will be loaded here -->
        </div>
        
        <div id="emptyState" class="empty-state" style="display:none;">
            <h3>Et ole vielÃ¤ luonut yhtÃ¤Ã¤n peliÃ¤</h3>
            <p>Aloita luomalla ensimmÃ¤inen pelisi!</p>
            <div class="create-game-cta">
                <a href="/hml/create-game.html" class="btn btn-primary">Luo uusi peli</a>
            </div>
        </div>
    </main>

    <script src="/js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!user.id) {
                window.location.href = '/hml/login.html';
                return;
            }
            
            // Check if user is GM
            const roles = JSON.parse(user.roles || '[]');
            if (!roles.includes('gm') && !user.is_admin) {
                alert('TÃ¤mÃ¤ sivu on vain GM-kÃ¤yttÃ¤jille');
                window.location.href = '/';
                return;
            }
            
            loadMyGames();
        });
        
        async function loadMyGames() {
            try {
                const response = await fetch('/api/games', {
                    headers: {
                        'Authorization': `Bearer ${getCookie('token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load games');
                }
                
                const allGames = await response.json();
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const myGames = allGames.filter(game => game.created_by === user.id);
                
                const grid = document.getElementById('myGamesGrid');
                const emptyState = document.getElementById('emptyState');
                
                if (myGames.length === 0) {
                    grid.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                grid.innerHTML = myGames.map(game => `
                    <div class="game-card">
                        <h3>${game.title}</h3>
                        <p>${game.description}</p>
                        <div class="game-stats">
                            <span>ðŸ“Š ${game.total_posts || 0} postausta</span>
                            <span>ðŸ‘¥ ${game.player_count || 0} pelaajaa</span>
                            <span>ðŸ“– ${game.chapter_count || 0} lukua</span>
                        </div>
                        <div class="game-actions">
                            <a href="/hml/gm-dashboard.html?game=${game.id}" class="btn btn-primary">
                                GM Dashboard
                            </a>
                            <a href="/hml/threads.html?game=${game.id}" class="btn btn-secondary">
                                NÃ¤ytÃ¤ peli
                            </a>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading games:', error);
                alert('Virhe pelien lataamisessa');
            }
        }
        
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
    </script>
</body>
</html>
